<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<div th:with="request=${req}">
    <input type="button" name="createRC" id="createRC" value="add center">
    <input type="hidden" id="reqID" th:value="${request.getRequest_id()}"/>
</div>
<div th:each="reqCent:${rcList}">
    <div>
        <select id="c_id" th:id="c_id+${reqCent.getRc()}" name="centers"
                onchange='changeCenter()' th:attr="onchange=|changeCenter('${reqCent.getRc()}')|">
            <option value="none" hidden="">Choose center</option>
            <option th:each="centerList:${cList}" th:value='${centerList.getCenter_id()}' th:text="${centerList.getRegion()}"></option>
        </select>
    </div>
    <input type="text" name="n_o_p" onchange="changeNOP()" th:attr="onchange=|changeNOP('${reqCent.getRc()}')|"
           th:id="n_o_p+${reqCent.getRc()}" placeholder='num of places' th:value='${reqCent.getNum_of_places()}'>
    <input type="datetime" name="start" onchange="changeStart()" th:attr="onchange=|changeStart('${reqCent.getRc()}')|"
           th:id="start+${reqCent.getRc()}" placeholder='start date' th:value='${reqCent.getDates().getStart_date()}'>
    <input type="datetime" name="finish" onchange="changeFinish()" th:attr="onchange=|changeFinish('${reqCent.getRc()}')|"
           th:id="finish+${reqCent.getRc()}" placeholder='finish date' th:value='${reqCent.getDates().getFinish_date()}'>
</div>
<div id="RC"></div>
</body>
<script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.2/jquery.min.js'></script>
<script th:inline="javascript">
    $(document).on('click', '#createRC', function () {
        $.ajax({
            url: "/createRequestCenter",
            data: {request_id: document.getElementById('reqID').value},
            type: "POST",
            success: function (data) {
                data = JSON.parse(data);
                console.log("your data: ", data);
                let rc_id = data;

                $("#RC").append(
                    "<div>" +
                    "      <div>\n" +
                    "            <select id=\"c_id" + rc_id + "\" onchange='changeCenter("+ rc_id +")' name=\"centers\">\n" +
                    "                  <option value=\"none\" hidden=\"\">Choose center</option>\n" +
                    /*[# th:each="centerList:${cList}"]*/
                    "                  <option value='[[${centerList.getCenter_id()}]]' >" + [[${centerList.getRegion()}]] + "</option>\n" +
                    /*[/]*/
                    "            </select>" +
                    "      </div>" +
                    "      <input type=\"text\" name=\"n_o_p\" onchange=\"changeNOP("+ rc_id +")\" id=\"n_o_p" + rc_id + "\" placeholder='num of places'>" +
                    "      <input type=\"datetime\" name=\"start\" onchange=\"changeStart("+ rc_id +")\" id=\"start" + rc_id + "\" placeholder='start date'>" +
                    "      <input type=\"datetime\" name=\"finish\" onchange=\"changeFinish("+ rc_id +")\" id=\"finish" + rc_id + "\" placeholder='finish date'>" +
                    "</div>"
                )
            }
        })
    })
</script>
<script>
    function changeNOP(rc_id){
        let rcnop = document.getElementById('n_o_p'+rc_id).value;
        $.ajax({
            url: "/updateRCNOP",
            data: {
                rc_id: rc_id,
                n_o_p: rcnop
            },
            type: "POST",
            success: function (data) {
                data = JSON.parse(data);
                console.log("your data: ", data);
            }
        })
    }

    function changeStart(rc_id){
        let rcstart = document.getElementById('start'+rc_id).value;
        $.ajax({
            url: "/updateRCStart",
            data: {
                rc_id: rc_id,
                start: rcstart
            },
            type: "POST",
            success: function (data) {
                data = JSON.parse(data);
                console.log("your data: ", data);
            }
        })
    }

    function changeFinish(rc_id){
        let rcfinish = document.getElementById('finish'+rc_id).value;
        $.ajax({
            url: "/updateRCFinish",
            data: {
                rc_id: rc_id,
                finish: rcfinish
            },
            type: "POST",
            success: function (data) {
                data = JSON.parse(data);
                console.log("your data: ", data);
            }
        })
    }

    function changeCenter(rc_id){
        let rcCenter = document.getElementById('c_id'+rc_id).value;
        $.ajax({
            url: "/updateRCCenter",
            data: {
                rc_id: rc_id,
                c_id: rcCenter
            },
            type: "POST",
            success: function (data) {
                data = JSON.parse(data);
                console.log("your data: ", data);
            }
        })
    }
</script>
<script src="js/index.js"></script>
</html>